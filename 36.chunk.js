"use strict";(self.webpackChunkreact_esri_template=self.webpackChunkreact_esri_template||[]).push([[36],{60036:(e,t,i)=>{i.r(t),i.d(t,{CIMSymbolRasterizer:()=>C,GeometryStyle:()=>h});var r=i(54721),o=i(39105),a=i(96071),n=i(88263),s=i(56885),l=i(93318),c=i(11426);class f{constructor(){}rasterizeText(e,t){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const i=this._textRasterizationCanvas,r=i.getContext("2d");this.setFontProperties(r,t),this.parameters=t,this.textLines=e.split(/\r?\n/),this.lineHeight=this.computeLineHeight();const o=this.computeTextWidth(r,t),a=this.lineHeight*this.textLines.length;i.width=o,i.height=a,this.renderedLineHeight=Math.round(this.lineHeight*t.pixelRatio),this.renderedHaloSize=t.halo.size*t.pixelRatio,this.renderedWidth=o*t.pixelRatio,this.renderedHeight=a*t.pixelRatio,this.fillStyle=function(e){return`rgba(${e.slice(0,3).toString()},${e[3]})`}(t.color),this.haloStyle=function(e){return`rgb(${e.slice(0,3).toString()})`}(t.halo.color);const n=this.renderedLineHeight,s=this.renderedHaloSize;this.setFontProperties(r,t);const l=function(e,t){return"center"===e?.5*t:"right"===e?t:0}(r.textAlign,this.renderedWidth)+s,c=s;let f=0,m=0;s>0&&this.renderHalo(r,l,c,f,m,t),m+=c,f+=l;for(const e of this.textLines)r.globalCompositeOperation="destination-out",r.fillStyle="rgb(0, 0, 0)",r.fillText(e,f,m),r.globalCompositeOperation="source-over",r.fillStyle=this.fillStyle,r.fillText(e,f,m),m+=n;const h=r.getImageData(0,0,this.renderedWidth,this.renderedHeight),u=new Uint8Array(h.data);if(t.premultiplyColors){let e;for(let t=0;t<u.length;t+=4)e=u[t+3]/255,u[t]=u[t]*e,u[t+1]=u[t+1]*e,u[t+2]=u[t+2]*e}return{size:[this.renderedWidth,this.renderedHeight],image:new Uint32Array(u.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}renderHalo(e,t,i,r,o,a){const n=this.renderedWidth,s=this.renderedHeight;this._haloRasterizationCanvas||(this._haloRasterizationCanvas=document.createElement("canvas")),this._haloRasterizationCanvas.width=n,this._haloRasterizationCanvas.height=s;const l=this._haloRasterizationCanvas,c=l.getContext("2d");c.clearRect(0,0,n,s),this.setFontProperties(c,a),c.fillStyle=this.haloStyle,c.strokeStyle=this.haloStyle;const f=this.renderedHaloSize<3;c.lineJoin=f?"miter":"round",f?this.renderHaloEmulated(c,t,i):this.renderHaloNative(c,t,i),e.globalAlpha=this.parameters.halo.color[3],e.drawImage(l,0,0,n,s,r,o,n,s),e.globalAlpha=1}renderHaloEmulated(e,t,i){const r=this.renderedLineHeight,o=this.renderedHaloSize;for(const a of this.textLines){for(const[r,n]of m)e.fillText(a,t+o*r,i+o*n);i+=r}}renderHaloNative(e,t,i){const r=this.renderedLineHeight,o=this.renderedHaloSize;for(const a of this.textLines){const n=2*o,s=5,l=.1;for(let r=0;r<s;r++){const o=1-(s-1)*l+r*l;e.lineWidth=o*n,e.strokeText(a,t,i)}i+=r}}setFontProperties(e,t){const i=t.font,r=`${i.style} ${i.weight} ${(0,a.F2)(t.size*t.pixelRatio)}px ${i.family}, sans-serif`;let o;switch(e.font=r,e.textBaseline="top",t.horizontalAlignment){case"left":o="left";break;case"right":o="right";break;case"center":o="center";break;default:o="left"}e.textAlign=o}computeTextWidth(e,t){let i=0;for(const t of this.textLines)i=Math.max(i,e.measureText(t).width);const r=t.font;return("italic"===r.style||"oblique"===r.style||"string"==typeof r.weight&&("bold"===r.weight||"bolder"===r.weight)||"number"==typeof r.weight&&r.weight>600)&&(i+=.3*e.measureText("A").width),i+=2*this.parameters.halo.size,Math.round(i)}computeLineHeight(){const e=1.275*this.parameters.size;return Math.round(e+2*this.parameters.halo.size)}}const m=[];{const e=16;for(let t=0;t<360;t+=360/e)m.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)])}var h,u,y=i(19546),g=i(14020),p=i(99178);(u=h||(h={})).Legend="legend",u.Preview="preview";const d=(e,t,i)=>{if(e&&e.targetSize){let r;if(i){const t=Math.max(i.frame.xmax-i.frame.xmin,i.frame.ymax-i.frame.ymin);r=e.targetSize/(0,a.F2)(t)}else r=e.targetSize/t.referenceSize;return r}return e&&e.scaleFactor?e.scaleFactor:1},S={fill:{legend:{frame:{xmax:15,xmin:0,ymax:15,ymin:0},geometry:{rings:[[[0,15],[15,7.5],[15,0],[0,0],[0,15]]]},canvasPaths:{rings:[[[0,15],[0,0],[15,7.5],[15,15],[0,15]]]}},preview:{frame:{xmax:100,xmin:0,ymax:100,ymin:0},geometry:{rings:[[[0,100],[100,100],[100,0],[0,0],[0,100]]]},canvasPaths:{rings:[[[0,100],[0,0],[100,0],[100,100],[0,100]]]}}},stroke:{legend:{frame:{xmax:24,xmin:0,ymax:-2,ymin:2},geometry:{paths:[[[0,0],[12,0],[24,0]]]},canvasPaths:{paths:[[[0,2],[12,2],[24,2]]]}},preview:{frame:{xmax:100,xmin:0,ymax:-2,ymin:2},geometry:{paths:[[[0,0],[50,0],[100,0]]]},canvasPaths:{paths:[[[0,2],[50,2],[100,2]]]}}}};class C{constructor(e,t){this._spatialReference=e,this._avoidSDF=t,this._resourceCache=new Map,this._rasterizer=new c.Z,this._textRasterizer=new f,this._pictureMarkerCache=new Map}async rasterizeCIMSymbolAsync(e,t,i,r,o,a,n,l){r=r||(t?null!=t.centroid?"esriGeometryPolygon":(0,s.Ji)(t.geometry):null)||function(e){if(!(e&&e.data&&e.data.symbol))return null;switch(e.data.symbol.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}(e);const c=await this.analyzeCIMSymbol(e,t?function(e){return(e?Object.keys(e):[]).map((t=>({name:t,alias:t,type:"string"==typeof e[t]?"esriFieldTypeString":"esriFieldTypeDouble"})))}(t.attributes):null,i,r,l);return this.rasterizeCIMSymbol(c,t,r,o,a,n)}async analyzeCIMSymbol(e,t,i,r,a){const n=[],s=t?{geometryType:r,spatialReference:this._spatialReference,fields:t}:null;let c;await(0,l.c)(e.data,s,n,this._avoidSDF),(0,o.k_)(a);for(const e of n)"CIMPictureMarker"!==e.cim.type&&"CIMPictureFill"!==e.cim.type&&"CIMPictureStroke"!==e.cim.type||(c||(c=[]),c.push(this.fetchPictureMarkerResource(e,a))),i&&"text"===e.type&&"string"==typeof e.text&&e.text.indexOf("[")>-1&&(e.text=(0,y.Qs)(i,e.text,e.cim.textCase));return c&&await Promise.all(c),n}async fetchPictureMarkerResource(e,t){const i=e.materialHash;if(!this._pictureMarkerCache.get(i)){const o=(await(0,r.default)(e.cim.url,{responseType:"image",signal:t&&t.signal})).data;this._pictureMarkerCache.set(i,o)}}rasterizeCIMSymbol(e,t,i,r,o,a){const n=[];for(const s of e){r&&"function"==typeof r.scaleFactor&&(r.scaleFactor=r.scaleFactor(t,o,a));const e=this._getRasterizedResource(s,t,i,r,o,a);if(!e)continue;let l=0,c=e.anchorX||0,f=e.anchorY||0,m=!1,h=0,u=0;if("esriGeometryPoint"===i){const e=d(r,s,null);if(h=(0,y.hf)(s.offsetX,t,o,a)*e||0,u=(0,y.hf)(s.offsetY,t,o,a)*e||0,"marker"===s.type)l=(0,y.hf)(s.rotation,t,o,a)||0,m=!!s.rotateClockwise&&s.rotateClockwise;else if("text"===s.type){if(l=(0,y.hf)(s.angle,t,o,a)||0,void 0!==s.horizontalAlignment)switch(s.horizontalAlignment){case"left":c=-.5;break;case"right":c=.5;break;default:c=0}if(void 0!==s.verticalAlignment)switch(s.verticalAlignment){case"top":f=.5;break;case"bottom":f=-.5;break;case"baseline":f=-.25;break;default:f=0}}}null!=e&&n.push({angle:l,rotateClockWise:m,anchorX:c,anchorY:f,offsetX:h,offsetY:u,rasterizedResource:e})}return this.getSymbolImage(n)}getSymbolImage(e){const t=document.createElement("canvas"),i=t.getContext("2d");let r=0,o=0,n=0,s=0;const l=[];for(let t=0;t<e.length;t++){const c=e[t],f=c.rasterizedResource;if(!f)continue;const m=f.size,h=c.offsetX,u=c.offsetY,y=c.anchorX,g=c.anchorY,p=c.rotateClockWise||!1;let d=c.angle,S=(0,a.F2)(h)-m[0]*(.5+y),C=(0,a.F2)(u)-m[1]*(.5+g),x=S+m[0],v=C+m[1];if(d){p&&(d=-d);const e=Math.sin(d*Math.PI/180),t=Math.cos(d*Math.PI/180),i=S*t-C*e,r=S*e+C*t,o=S*t-v*e,a=S*e+v*t,n=x*t-v*e,s=x*e+v*t,l=x*t-C*e,c=x*e+C*t;S=Math.min(i,o,n,l),C=Math.min(r,a,s,c),x=Math.max(i,o,n,l),v=Math.max(r,a,s,c)}r=S<r?S:r,o=C<o?C:o,n=x>n?x:n,s=v>s?v:s;const b=i.createImageData(f.size[0],f.size[1]);b.data.set(new Uint8ClampedArray(f.image.buffer));const M={offsetX:h,offsetY:u,rotateClockwise:p,angle:d,rasterizedImage:b,anchorX:y,anchorY:g};l.push(M)}t.width=n-r,t.height=s-o;const c=-r,f=s;for(let e=0;e<l.length;e++){const t=l[e],r=this._imageDataToCanvas(t.rasterizedImage),o=t.rasterizedImage.width,n=t.rasterizedImage.height,s=c-o*(.5+t.anchorX),m=f-n*(.5-t.anchorY);if(t.angle){const e=(360-t.angle)*Math.PI/180;i.save(),i.translate((0,a.F2)(t.offsetX),-(0,a.F2)(t.offsetY)),i.translate(c,f),i.rotate(e),i.translate(-c,-f),i.drawImage(r,s,m),i.restore()}else i.drawImage(r,s+(0,a.F2)(t.offsetX),m-(0,a.F2)(t.offsetY))}const m=new p.Z({x:c/t.width-.5,y:f/t.height-.5});return{imageData:0!==t.width&&0!==t.height?i.getImageData(0,0,t.width,t.height):i.createImageData(1,1),anchorPosition:m}}_imageDataToCanvas(e){this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas"));const t=this._imageDataCanvas,i=t.getContext("2d");return t.width=e.width,t.height=e.height,i.putImageData(e,0,0),t}_imageTo32Array(e,t,i){this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas"));const r=this._imageDataCanvas,o=r.getContext("2d");return r.width=t,r.height=i,o.drawImage(e,0,0,t,i),new Uint32Array(o.getImageData(0,0,t,i).data.buffer)}_getRasterizedResource(e,t,i,r,o,a){let s,l,c,f;if("esriGeometryPolyline"===i||"esriGeometryPolygon"===i){const f=r&&r.style?r.style:h.Legend,m="esriGeometryPolyline"===i?S.stroke[f]:S.fill[f];if("line"===e.type){if("CIMSolidStroke"!==e.cim.type){if("CIMPictureStroke"===e.cim.type){const i=(0,y.hf)(e.width,t,o,a),{image:r,width:n,height:s}=this._getPictureResource(e,i);return this._rasterizePictureResource(e,r,n,s,m,i)}return null}({analyzedCIM:s,hash:c}=x(e,t,o,a)),l=this._embedCIMLayerInVectorMarker(s,m)}else if("marker"===e.type){if("CIMPictureMarker"===e.cim.type)return null;if("CIMVectorMarker"!==e.cim.type)return null;e.cim.offsetX=(0,y.hf)(e.offsetX,t,o,a),e.cim.offsetY=(0,y.hf)(e.offsetY,t,o,a),e.cim.rotation=(0,y.hf)(e.rotation,t,o,a),e.cim.markerPlacement=e.markerPlacement,({analyzedCIM:s}=x(e,t,o,a)),c=(0,n.hP)(JSON.stringify(s)).toString(),l=this._embedCIMLayerInVectorMarker(s,m)}else{if("text"===e.type)return null;if("fill"===e.type){if("CIMHatchFill"===e.cim.type||"CIMVectorMarker"===e.cim.type||"CIMPictureMarker"===e.cim.type||"CIMPictureFill"===e.cim.type){const i=e.cim.size||e.cim.height;let r,n,l;if("CIMPictureMarker"===e.cim.type||"CIMPictureFill"===e.cim.type)({image:r,width:n,height:l}=this._getPictureResource(e,i));else{({analyzedCIM:s,hash:c}=x(e,t,o,a));const i=this._rasterizer.rasterizeJSONResource(s,1,this._avoidSDF);r=i.image,n=i.size[0],l=i.size[1]}return this._rasterizePictureResource(e,r,n,l,m,null)}if("CIMSolidFill"!==e.cim.type)return null;({analyzedCIM:s,hash:c}=x(e,t,o,a)),l=this._embedCIMLayerInVectorMarker(s,m)}}}else{if("text"===e.type)return f=this._rasterizeTextResource(e,t,r,o,a),f;({analyzedCIM:s,hash:c}=x(e,t,o,a));const i=d(r,e,null);if("CIMPictureMarker"===e.cim.type){const r=(0,y.hf)(e.size,t,o,a)*i,{image:n,width:s,height:l}=this._getPictureResource(e,r);return f={image:n,size:[s,l],sdf:!1,simplePattern:!1,anchorX:e.anchorPoint?e.anchorPoint.x:0,anchorY:e.anchorPoint?e.anchorPoint.y:0},f}(0,g.FW)(s,i,{preserveOutlineWidth:!1}),l=s}c+=i,r&&(c+=JSON.stringify(r));const m=this._resourceCache;return m.has(c)?m.get(c):(f=this._rasterizer.rasterizeJSONResource(l,window.devicePixelRatio||1,this._avoidSDF),m.set(c,f),f)}_rasterizeTextResource(e,t,i,r,o){const a=d(i,e,null),n=(0,y.hf)(e.text,t,r,o);if(!n||0===n.length)return null;const s=(0,y.hf)(e.fontName,t,r,o),l=(0,y.hf)(e.style,t,r,o),c=(0,y.hf)(e.weight,t,r,o),f=(0,y.hf)(e.decoration,t,r,o),m=(0,y.hf)(e.size,t,r,o)*a,h=(0,y.hf)(e.horizontalAlignment,t,r,o),u=(0,y.hf)(e.verticalAlignment,t,r,o),g=(0,y.nn)((0,y.hf)(e.color,t,r,o)),p=(0,y.nn)((0,y.hf)(e.outlineColor,t,r,o)),S={color:g,size:m,horizontalAlignment:h,verticalAlignment:u,font:{family:s,style:l,weight:c,decoration:f},halo:{size:(0,y.hf)(e.outlineSize,t,r,o)||0,color:p,style:l},pixelRatio:1,premultiplyColors:!this._avoidSDF};return this._textRasterizer.rasterizeText(n,S)}_rasterizePictureResource(e,t,i,r,o,n){const l=document.createElement("canvas"),c=l.getContext("2d");l.height=(0,a.F2)(Math.max(Math.abs(o.frame.ymax-o.frame.ymin),n)),l.width=(0,a.F2)(Math.abs(o.frame.xmax-o.frame.xmin));const f=c.createImageData(i,r);f.data.set(new Uint8ClampedArray(t.buffer));const m=this._imageDataToCanvas(f),h=c.createPattern(m,"repeat"),u=Math.cos((-e.cim.rotation||0)*Math.PI/180),y=Math.sin((-e.cim.rotation||0)*Math.PI/180);h.setTransform({m11:u,m12:y,m21:-y,m22:u,m41:(0,a.F2)(e.cim.offsetX)||0,m42:(0,a.F2)(e.cim.offsetY)||0});const g=o.canvasPaths;let p,d,S;(0,s.oU)(g)?(p=g.rings,c.fillStyle=h,d=c.fill,S=["evenodd"]):(0,s.l9)(g)&&(p=g.paths,c.strokeStyle=h,c.lineWidth=n,d=c.stroke,p[0][0][1]=l.height/2,p[0][1][1]=l.height/2),c.beginPath();for(const e of p){const t=e?e.length:0;if(t>1){let i=e[0];c.moveTo((0,a.F2)(i[0]),(0,a.F2)(i[1]));for(let r=1;r<t;++r)i=e[r],c.lineTo((0,a.F2)(i[0]),(0,a.F2)(i[1]));c.closePath()}}d.apply(c,S);const C=c.getImageData(0,0,l.width,l.height),x=new Uint8Array(C.data);return{size:[l.width,l.height],image:new Uint32Array(x.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}_getPictureResource(e,t){const i=this._pictureMarkerCache.get(e.materialHash);if(!i)return null;const r=i.height/i.width,o=t?r>1?(0,a.F2)(t):(0,a.F2)(t)/r:i.width,n=t?r>1?(0,a.F2)(t)*r:(0,a.F2)(t):i.height;return{image:this._imageTo32Array(i,o,n),width:o,height:n}}_embedCIMLayerInVectorMarker(e,t){const i=(0,s.oU)(t.geometry)?"CIMPolygonSymbol":"CIMLineSymbol";return{type:"CIMVectorMarker",frame:t.frame,markerGraphics:[{type:"CIMMarkerGraphic",geometry:t.geometry,symbol:{type:i,symbolLayers:[e]}}]}}}function x(e,t,i,r){let o,a;return"function"==typeof e.materialHash?(o=(0,e.materialHash)(t,i,r),a=(0,l.S)(e.cim,e.materialOverrides)):(o=e.materialHash,a=e.cim),{analyzedCIM:a,hash:o}}},11426:(e,t,i)=>{i.d(t,{Z:()=>s});var r=i(36889),o=i(90169),a=i(71108),n=i(19546);const s=class{dispose(){this._rasterizationCanvas=null}rasterizeJSONResource(e,t,i){if(this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas")),"simple-fill"===e.type||"esriSFS"===e.type){const[i,o,a]=r.fN.rasterizeSimpleFill(this._rasterizationCanvas,e.style,t);return{size:[o,a],image:new Uint32Array(i.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0}}if("simple-line"===e.type||"esriSLS"===e.type){const[t,i,o]=r.fN.rasterizeSimpleLine(e.style,e.cap);return{size:[i,o],image:new Uint32Array(t.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}}let n,s,l;if("simple-marker"===e.type||"esriSMS"===e.type||"line-marker"===e.type?(n=r.B$.fromSimpleMarker(e),l=(0,a.Fp)(n)):"CIMHatchFill"===e.type?(n=r.B$.fromCIMHatchFill(e),s=new o.Z(n.frame.xmin,-n.frame.ymax,n.frame.xmax-n.frame.xmin,n.frame.ymax-n.frame.ymin)):e.markerPlacement&&"CIMMarkerPlacementInsidePolygon"===e.markerPlacement.type?(n=r.B$.fromCIMInsidePolygon(e),s=new o.Z(n.frame.xmin,-n.frame.ymax,n.frame.xmax-n.frame.xmin,n.frame.ymax-n.frame.ymin)):(n=e,l=(0,a.Fp)(n)),l&&!i){const[e,t,i]=(0,a.RL)(l);return e?{size:[t,i],image:new Uint32Array(e.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}:null}const[c,f,m,h,u]=r.B$.rasterize(this._rasterizationCanvas,n,s,!i);return c?{size:[f,m],image:new Uint32Array(c.buffer),sdf:!1,simplePattern:!1,anchorX:h,anchorY:u}:null}rasterizeImageResource(e,t,i,r){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas")),this._rasterizationCanvas.width=e,this._rasterizationCanvas.height=t;const o=this._rasterizationCanvas.getContext("2d");i instanceof ImageData?o.putImageData(i,0,0):(i.setAttribute("width",`${e}px`),i.setAttribute("height",`${t}px`),o.drawImage(i,0,0,e,t));const a=o.getImageData(0,0,e,t),s=new Uint8Array(a.data);if(r)for(const e of r)if(e&&e.oldColor&&4===e.oldColor.length&&e.newColor&&4===e.newColor.length){const[t,i,r,o]=e.oldColor,[a,n,l,c]=e.newColor;if(t===a&&i===n&&r===l&&o===c)continue;for(let e=0;e<s.length;e+=4)t===s[e]&&i===s[e+1]&&r===s[e+2]&&o===s[e+3]&&(s[e]=a,s[e+1]=n,s[e+2]=l,s[e+3]=c)}let l;for(let e=0;e<s.length;e+=4)l=s[e+3]/255,s[e]=s[e]*l,s[e+1]=s[e+1]*l,s[e+2]=s[e+2]*l;let c=s,f=e,m=t;const h=512;if(f>=h||m>=h){const i=f/m;i>1?(f=h,m=Math.round(h/i)):(m=h,f=Math.round(h*i)),c=new Uint8Array(4*f*m);const r=new Uint8ClampedArray(c.buffer);(0,n.TT)(s,e,t,r,f,m,!1)}return{size:[f,m],image:new Uint32Array(c.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}}},71108:(e,t,i)=>{i.d(t,{RL:()=>f,bk:()=>l,Fp:()=>n,UV:()=>c});var r=i(56885),o=i(69688),a=i(90169);function n(e){if(!e)return null;switch(e.type){case"CIMPointSymbol":{const t=e.symbolLayers;return t&&1===t.length?n(t[0]):null}case"CIMVectorMarker":{const t=e.markerGraphics;if(!t||1!==t.length)return null;const i=t[0];if(!i)return null;const r=i.geometry;if(!r)return null;const o=i.symbol;return!o||"CIMPolygonSymbol"!==o.type&&"CIMLineSymbol"!==o.type?null:{geom:r,asFill:"CIMPolygonSymbol"===o.type}}case"sdf":return{geom:e.geom,asFill:e.asFill}}return null}function s(e){let t=1/0,i=-1/0,r=1/0,o=-1/0;for(const a of e)for(const e of a)e[0]<t&&(t=e[0]),e[0]>i&&(i=e[0]),e[1]<r&&(r=e[1]),e[1]>o&&(o=e[1]);return[t,r,i,o]}function l(e){return e?e.rings?s(e.rings):e.paths?s(e.paths):(0,r.YX)(e)?[e.xmin,e.ymin,e.xmax,e.ymax]:null:null}function c(e,t,i,r,o){const[a,n,s,l]=e;if(s<a||l<n)return[0,0,0];const c=s-a,f=l-n,m=Math.floor(31.5),h=(128-2*(m+1))/Math.max(c,f),u=Math.round(c*h)+2*m,y=Math.round(f*h)+2*m;let g=1;t&&(g=y/h/(t.ymax-t.ymin));let p=0,d=0;if(r)if(o){if(t&&i&&t.ymax-t.ymin>0){const e=(t.xmax-t.xmin)/(t.ymax-t.ymin);p=r.x/(i*e),d=r.y/i}}else p=r.x,d=r.y;return p=.5*(t.xmax+t.xmin)+p*(t.xmax-t.xmin),d=.5*(t.ymax+t.ymin)+d*(t.ymax-t.ymin),p-=a,d-=n,p*=h,d*=h,p+=m,d+=m,[g,p/u-.5,-(d/y-.5)]}function f(e){const t=function(e){return e?e.rings?e.rings:e.paths?e.paths:void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax?[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]:null:null}(e.geom),i=function(e){let t=1/0,i=-1/0,r=1/0,o=-1/0;for(const a of e)for(const e of a)e[0]<t&&(t=e[0]),e[0]>i&&(i=e[0]),e[1]<r&&(r=e[1]),e[1]>o&&(o=e[1]);return new a.Z(t,r,i-t,o-r)}(t),r=Math.floor(31.5),o=(128-2*(r+1))/Math.max(i.width,i.height),n=Math.round(i.width*o)+2*r,s=Math.round(i.height*o)+2*r,l=[];for(const a of t)if(a&&a.length>1){const t=[];for(const e of a){let[a,n]=e;a-=i.x,n-=i.y,a*=o,n*=o,a+=r-.5,n+=r-.5,t.push([a,n])}if(e.asFill){const e=t.length-1;t[0][0]===t[e][0]&&t[0][1]===t[e][1]||t.push(t[0])}l.push(t)}const c=function(e,t,i,r){const o=t*i,a=new Array(o),n=r*r+1;for(let e=0;e<o;++e)a[e]=n;for(const o of e){const e=o.length;for(let n=1;n<e;++n){const e=o[n-1],s=o[n];let l,c,f,m;e[0]<s[0]?(l=e[0],c=s[0]):(l=s[0],c=e[0]),e[1]<s[1]?(f=e[1],m=s[1]):(f=s[1],m=e[1]);let h=Math.floor(l)-r,u=Math.floor(c)+r,y=Math.floor(f)-r,g=Math.floor(m)+r;h<0&&(h=0),u>t&&(u=t),y<0&&(y=0),g>i&&(g=i);const p=s[0]-e[0],d=s[1]-e[1],S=p*p+d*d;for(let r=h;r<u;r++)for(let o=y;o<g;o++){let n,l,c=(r-e[0])*p+(o-e[1])*d;c<0?(n=e[0],l=e[1]):c>S?(n=s[0],l=s[1]):(c/=S,n=e[0]+c*p,l=e[1]+c*d);const f=(r-n)*(r-n)+(o-l)*(o-l),m=(i-o-1)*t+r;f<a[m]&&(a[m]=f)}}}for(let e=0;e<o;++e)a[e]=Math.sqrt(a[e]);return a}(l,n,s,r);return e.asFill&&function(e,t,i,r,o){for(const a of e){const e=a.length;for(let n=1;n<e;++n){const e=a[n-1],s=a[n];let l,c,f,m;e[0]<s[0]?(l=e[0],c=s[0]):(l=s[0],c=e[0]),e[1]<s[1]?(f=e[1],m=s[1]):(f=s[1],m=e[1]);let h=Math.floor(l),u=Math.floor(c)+1,y=Math.floor(f),g=Math.floor(m)+1;h<r&&(h=r),u>t-r&&(u=t-r),y<r&&(y=r),g>i-r&&(g=i-r);for(let a=y;a<g;++a){if(e[1]>a==s[1]>a)continue;const n=(i-a-1)*t;for(let t=h;t<u;++t)t<(s[0]-e[0])*(a-e[1])/(s[1]-e[1])+e[0]&&(o[n+t]=-o[n+t]);for(let e=r;e<h;++e)o[n+e]=-o[n+e]}}}}(l,n,s,r,c),[m(c,r),n,s]}function m(e,t){const i=2*t,r=e.length,a=new Uint8Array(4*r);for(let t=0;t<r;++t){const r=.5-e[t]/i;(0,o.I)(r,a,4*t)}return a}},93318:(e,t,i)=>{i.d(t,{S:()=>A,c:()=>C});var r=i(78745),o=i(36544),a=i(96071),n=i(88263),s=i(30927),l=i(36889),c=i(71108),f=i(19546),m=i(49723);const h=o.Z.getLogger("esri.symbols.cim.cimAnalyzer");function u(e){switch(e){case"Butt":return 0;case"Square":return 2;case"Round":default:return 1}}function y(e){switch(e){case"Bevel":return 0;case"Miter":return 2;case"Round":default:return 1}}function g(e){switch(e){case"Left":default:return"left";case"Right":return"right";case"Center":return"center";case"Justify":return"justify"}}function p(e){switch(e){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function d(e,t,i,r){let o;e[t]?o=e[t]:(o={},e[t]=o),o[i]=r}function S(e){const t=e.markerPlacement;return t&&t.angleToLine?1:0}async function C(e,t,i,r){const o=null!=i?i:[];if(!e)return o;let a,n;const c={};if("CIMSymbolReference"!==e.type)return h.error("Expect cim type to be 'CIMSymbolReference'"),o;if(a=e.symbol,n=e.primitiveOverrides,n){const e=[];for(const i of n){const r=i.valueExpressionInfo;if(r&&t){const o=r.expression,a=(0,s.Yi)(o,t.spatialReference,t.fields).then((e=>{e&&d(c,i.primitiveName,i.propertyName,e)}));e.push(a)}else null!=i.value&&d(c,i.primitiveName,i.propertyName,i.value)}await Promise.all(e)}switch(a.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":!function(e,t,i,r,o,a){if(!e)return;const n=e.symbolLayers;if(!n)return;let s;const c=l.B$.getSize(e);"CIMPointSymbol"===e.type&&"Map"===e.angleAlignment&&(s=1);let f=n.length;for(;f--;){const m=n[f];if(!m||!1===m.enable)continue;const u=[];switch(l.E0.findApplicableOverrides(m,t,u),m.type){case"CIMSolidFill":x(m,i,u,r,o);break;case"CIMPictureFill":v(m,i,u,r,o);break;case"CIMHatchFill":b(m,i,u,r,o);break;case"CIMGradientFill":M(m,i,u,r,o);break;case"CIMSolidStroke":P(m,i,u,r,o,"CIMPolygonSymbol"===e.type,c);break;case"CIMPictureStroke":k(m,i,u,r,o,"CIMPolygonSymbol"===e.type,c);break;case"CIMGradientStroke":z(m,i,u,r,o,"CIMPolygonSymbol"===e.type,c);break;case"CIMCharacterMarker":if(I(m,i,u,r,o))break;break;case"CIMPictureMarker":if(I(m,i,u,r,o))break;"CIMLineSymbol"===e.type&&(s=S(m)),w(m,i,u,r,o,s,c);break;case"CIMVectorMarker":if(I(m,i,u,r,o))break;"CIMLineSymbol"===e.type&&(s=S(m)),N(m,i,u,r,o,s,c,a);break;default:h.error("Cannot analyze CIM layer",m.type)}}}(a,n,c,t,o,r)}return o}function x(e,t,i,r,o){const a=e.primitiveName,s=(0,f.NO)(e.color),[l,c]=Y(i,a),m=(0,n.hP)(JSON.stringify(e)+c).toString();o.push({type:"fill",templateHash:m,materialHash:l?()=>m:m,cim:e,materialOverrides:null,colorLocked:e.colorLocked,color:X(a,t,"Color",r,s,_),height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,effects:e.effects})}function v(e,t,i,r,o){const a=e.primitiveName,s=e.tintColor?(0,f.NO)(e.tintColor):{r:255,g:255,b:255,a:1},[l,c]=Y(i,a),m=(0,n.hP)(JSON.stringify(e)+c).toString(),h=(0,n.hP)(`${e.url}${JSON.stringify(e.colorSubstitutions)}`).toString();o.push({type:"fill",templateHash:m,materialHash:l?()=>h:h,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,color:X(a,t,"TintColor",r,s,_),height:X(a,t,"Height",r,e.height),scaleX:X(a,t,"ScaleX",r,e.scaleX),angle:X(a,t,"Rotation",r,e.rotation),offsetX:X(a,t,"OffsetX",r,e.offsetX),offsetY:X(a,t,"OffsetY",r,e.offsetY)})}function b(e,t,i,r,o){const a=["Rotation","OffsetX","OffsetY"],s=i.filter((t=>t.primitiveName!==e.primitiveName&&-1===a.indexOf(t.propertyName))),l=e.primitiveName,[c,f]=Y(i,l),m=(0,n.hP)(JSON.stringify(e)+f).toString(),h=(0,n.hP)(`${e.separation}${JSON.stringify(e.lineSymbol)}`).toString();o.push({type:"fill",templateHash:m,materialHash:c?H(h,t,s,r):h,cim:e,materialOverrides:s,colorLocked:e.colorLocked,effects:e.effects,color:{r:255,g:255,b:255,a:1},height:X(l,t,"Separation",r,e.separation),scaleX:1,angle:X(l,t,"Rotation",r,e.rotation),offsetX:X(l,t,"OffsetX",r,e.offsetX),offsetY:X(l,t,"OffsetY",r,e.offsetY)})}function M(e,t,i,r,o){const a=e.primitiveName,[s,l]=Y(i,a),c=(0,n.hP)(JSON.stringify(e)+l).toString();o.push({type:"fill",templateHash:c,materialHash:s?H(c,t,i,r):c,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,color:{r:128,g:128,b:128,a:1},height:0,angle:0,offsetX:0,offsetY:0,scaleX:1})}function P(e,t,i,r,o,a,s){const l=e.primitiveName,c=(0,f.NO)(e.color),m=void 0!==e.width?e.width:4,h=u(e.capStyle),g=y(e.joinStyle),p=e.miterLimit,[d,S]=Y(i,l),C=(0,n.hP)(JSON.stringify(e)+S).toString();o.push({type:"line",templateHash:C,materialHash:d?()=>C:C,cim:e,materialOverrides:null,isOutline:a,colorLocked:e.colorLocked,effects:e.effects,color:X(l,t,"Color",r,c,_),width:X(l,t,"Width",r,m),cap:X(l,t,"CapStyle",r,h),join:X(l,t,"JoinStyle",r,g),miterLimit:X(l,t,"MiterLimit",r,p),referenceWidth:s,zOrder:R(e.name),isDashed:!1})}function k(e,t,i,r,o,a,s){const l=(0,n.hP)(`${e.url}${JSON.stringify(e.colorSubstitutions)}`).toString(),c=e.primitiveName,m=(0,f.NO)(e.tintColor),h=void 0!==e.width?e.width:4,g=u(e.capStyle),p=y(e.joinStyle),d=e.miterLimit,[S,C]=Y(i,c),x=(0,n.hP)(JSON.stringify(e)+C).toString();o.push({type:"line",templateHash:x,materialHash:S?()=>l:l,cim:e,materialOverrides:null,isOutline:a,colorLocked:e.colorLocked,effects:e.effects,color:X(c,t,"TintColor",r,m,_),width:X(c,t,"Width",r,h),cap:X(c,t,"CapStyle",r,g),join:X(c,t,"JoinStyle",r,p),miterLimit:X(c,t,"MiterLimit",r,d),referenceWidth:s,zOrder:R(e.name),isDashed:!1})}function z(e,t,i,r,o,a,s){const l=e.primitiveName,c=void 0!==e.width?e.width:4,f=u(e.capStyle),m=y(e.joinStyle),h=e.miterLimit,[g,p]=Y(i,l),d=(0,n.hP)(JSON.stringify(e)+p).toString();o.push({type:"line",templateHash:d,materialHash:g?H(d,t,i,r):d,cim:e,materialOverrides:null,isOutline:a,colorLocked:e.colorLocked,effects:e.effects,color:{r:128,g:128,b:128,a:1},width:X(l,t,"Width",r,c),cap:X(l,t,"CapStyle",r,f),join:X(l,t,"JoinStyle",r,m),miterLimit:X(l,t,"MiterLimit",r,h),referenceWidth:s,zOrder:R(e.name),isDashed:!1})}function I(e,t,i,r,o){const a=e.markerPlacement;if(!a||"CIMMarkerPlacementInsidePolygon"!==a.type)return!1;const s=a,l=["Rotation","OffsetX","OffsetY"],c=i.filter((t=>t.primitiveName!==e.primitiveName&&-1===l.indexOf(t.propertyName))),[f,m]=Y(i,s.primitiveName),h=(0,n.hP)(JSON.stringify(e)+m).toString();return o.push({type:"fill",templateHash:h,materialHash:f?H(h,t,c,r):h,cim:e,materialOverrides:c,colorLocked:e.colorLocked,effects:e.effects,color:{r:255,g:255,b:255,a:1},height:X(s.primitiveName,t,"StepY",r,s.stepY),scaleX:1,angle:X(s.primitiveName,t,"GridAngle",r,s.gridAngle),offsetX:X(s.primitiveName,t,"OffsetX",r,s.offsetX),offsetY:X(s.primitiveName,t,"OffsetY",r,s.offsetY)}),!0}function w(e,t,i,r,o,a,s){const l=e.primitiveName,c=e.size,m=e.scaleX,h=e.rotation,u=e.offsetX,y=e.offsetY,g=(0,f.NO)(e.tintColor),p=(0,n.hP)(`${e.url}${JSON.stringify(e.colorSubstitutions)}`).toString(),[d,S]=Y(i,l),C=(0,n.hP)(JSON.stringify(e)+S).toString();o.push({type:"marker",templateHash:C,materialHash:d?()=>p:p,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,scaleSymbolsProportionally:!1,alignment:a,size:X(l,t,"Size",r,c),scaleX:X(l,t,"ScaleX",r,m),rotation:X(l,t,"Rotation",r,h),offsetX:X(l,t,"OffsetX",r,u),offsetY:X(l,t,"OffsetY",r,y),color:X(l,t,"TintColor",r,g,_),anchorPoint:e.anchorPoint,isAbsoluteAnchorPoint:"Relative"!==e.anchorPointUnits,outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,frameHeight:0,rotateClockwise:e.rotateClockwise,referenceSize:s,sizeRatio:1,markerPlacement:e.markerPlacement})}function N(e,t,i,r,o,a,n,s){const l=e.markerGraphics;if(!l)return;let c=0;if(e.scaleSymbolsProportionally){const t=e.frame;t&&(c=t.ymax-t.ymin)}for(const f of l)if(f){const l=f.symbol;if(!l)continue;switch(l.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":L(e,f,i,t,r,o,a,n,c,s);break;case"CIMTextSymbol":O(e,f,t,i,r,o,a,n,c)}}}function O(e,t,i,r,o,a,s,c,m){l.E0.findApplicableOverrides(t,r,[]);const h=t.geometry;if(!("x"in h)||!("y"in h))return;const u=t.symbol,y=function(e){return e.underline?"underline":e.strikethrough?"line-through":"none"}(u),d=function(e){let t="normal",i="normal";if(e){const r=e.toLowerCase();-1!==r.indexOf("italic")?t="italic":-1!==r.indexOf("oblique")&&(t="oblique"),-1!==r.indexOf("bold")?i="bold":-1!==r.indexOf("light")&&(i="lighter")}return{style:t,weight:i}}(u.fontStyleName);u.font={family:u.fontFamilyName,decoration:y,...d};const S=e.frame,C=h.x-.5*(S.xmin+S.xmax),x=h.y-.5*(S.ymin+S.ymax),v=e.size/m,b=e.primitiveName,M=(u.height||0)*v,P=u.angle||0,k=((u.offsetX||0)+C)*v,z=((u.offsetY||0)+x)*v,I=(0,f.NO)(l.B$.getFillColor(u));let w=(0,f.NO)(l.B$.getStrokeColor(u)),N=l.B$.getStrokeWidth(u);N||(w=(0,f.NO)(l.B$.getFillColor(u.haloSymbol)),N=u.haloSize*v);let O="";for(const e of r)e.primitiveName===b&&void 0!==e.value&&(O+=`-${e.primitiveName}-${e.propertyName}-${JSON.stringify(e.value)}`);const L=JSON.stringify(e.effects)+Number(e.colorLocked)+JSON.stringify(e.anchorPoint)+e.anchorPointUnits+JSON.stringify(e.markerPlacement),F=(0,n.hP)(JSON.stringify(t)+L+O).toString();a.push({type:"text",templateHash:F,materialHash:()=>(0,n.hP)(JSON.stringify(u.font)).toString(),cim:u,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,alignment:s,anchorPoint:{x:e.anchorPoint?e.anchorPoint.x:0,y:e.anchorPoint?e.anchorPoint.y:0},isAbsoluteAnchorPoint:"Relative"!==e.anchorPointUnits,fontName:u.fontFamilyName,decoration:"none",weight:"normal",style:"normal",size:X(b,i,"Size",o,M),angle:X(b,i,"Rotation",o,P),offsetX:X(b,i,"OffsetX",o,k),offsetY:X(b,i,"OffsetY",o,z),horizontalAlignment:g(u.horizontalAlignment),verticalAlignment:p(u.verticalAlignment),text:X(t.primitiveName,i,"TextString",o,t.textString,f.X3,u.textCase),color:I,outlineColor:w,outlineSize:N,referenceSize:c,sizeRatio:1,markerPlacement:e.markerPlacement})}function L(e,t,i,r,o,a,s,m,h,u){const y=t.symbol,g=t.geometry;if(!g)return;const p=y.symbolLayers;if(!p)return;if(u)return void F(e,t,r,i,o,a,s,m,h);let d=p.length;for(;d--;){const u=p[d];if(u&&!1!==u.enable)switch(u.type){case"CIMSolidFill":case"CIMSolidStroke":{const y=(0,c.bk)(g);if(!y)continue;const[p,d,S]=(0,c.UV)(y,e.frame,e.size,e.anchorPoint,"Relative"!==e.anchorPointUnits),C="CIMSolidFill"===u.type,x={type:"sdf",geom:g,asFill:C},v=e.primitiveName,b=e.size,M=e.rotation||0,P=e.offsetX,k=e.offsetY,z=u.primitiveName,I=(0,f.NO)(C?l.B$.getFillColor(u):l.B$.getStrokeColor(u)),w=C?{r:0,g:0,b:0,a:0}:(0,f.NO)(l.B$.getStrokeColor(u)),N=l.B$.getStrokeWidth(u);if(!C&&!N)break;let O=!1,L="";for(const e of i)e.primitiveName!==z&&e.primitiveName!==v||(void 0!==e.value?L+=`-${e.primitiveName}-${e.propertyName}-${JSON.stringify(e.value)}`:e.valueExpressionInfo&&(O=!0));const F=JSON.stringify({...e,markerGraphics:null}),R=(0,n.hP)(JSON.stringify(x)).toString(),H={type:"marker",templateHash:(0,n.hP)(JSON.stringify(t)+JSON.stringify(u)+F+L).toString(),materialHash:O?()=>R:R,cim:x,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:s,anchorPoint:{x:d,y:S},isAbsoluteAnchorPoint:!1,size:X(e.primitiveName,r,"Size",o,b),rotation:X(e.primitiveName,r,"Rotation",o,M),offsetX:X(e.primitiveName,r,"OffsetX",o,P),offsetY:X(e.primitiveName,r,"OffsetY",o,k),scaleX:1,frameHeight:h,rotateClockwise:e.rotateClockwise,referenceSize:m,sizeRatio:p,color:X(z,r,"Color",o,I,_),outlineColor:X(z,r,"Color",o,w,_),outlineWidth:X(z,r,"Width",o,N),markerPlacement:e.markerPlacement};a.push(H);break}default:F(e,t,r,i,o,a,s,m,h)}}}function F(e,t,i,r,o,s,c,f,m){const h=function(e,t){return{type:e.type,enable:!0,name:e.name,colorLocked:e.colorLocked,primitiveName:e.primitiveName,anchorPoint:e.anchorPoint,anchorPointUnits:e.anchorPointUnits,offsetX:0,offsetY:0,rotateClockwise:e.rotateClockwise,rotation:0,size:e.size,billboardMode3D:e.billboardMode3D,depth3D:e.depth3D,frame:e.frame,markerGraphics:[t],scaleSymbolsProportionally:e.scaleSymbolsProportionally,respectFrame:e.respectFrame,clippingPath:e.clippingPath,effects:e.effects}}(e,t);let u=[];const y=["Rotation","OffsetX","OffsetY"];u=r.filter((t=>t.primitiveName!==e.primitiveName||-1===y.indexOf(t.propertyName)));let g="";for(const e of r)void 0!==e.value&&(g+=`-${e.primitiveName}-${e.propertyName}-${JSON.stringify(e.value)}`);const[p,d,S]=l.B$.getTextureAnchor(h),C=e.primitiveName,x=e.rotation||0,v=e.offsetX||0,b=e.offsetY||0,M=(0,n.hP)(JSON.stringify(h)+g).toString(),P={type:"marker",templateHash:M,materialHash:0===u.length?M:H(M,i,u,o),cim:h,materialOverrides:u,colorLocked:e.colorLocked,effects:e.effects,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:c,anchorPoint:{x:p,y:d},isAbsoluteAnchorPoint:!1,size:e.size,rotation:X(C,i,"Rotation",o,x),offsetX:X(C,i,"OffsetX",o,v),offsetY:X(C,i,"OffsetY",o,b),color:{r:0,g:0,b:0,a:0},outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,scaleX:1,frameHeight:m,rotateClockwise:e.rotateClockwise,referenceSize:f,sizeRatio:S/(0,a.F2)(e.size),markerPlacement:e.markerPlacement};s.push(P)}function R(e){if(e&&0===e.indexOf("Level_")){const t=parseInt(e.substr(6),10);if(NaN!==t)return t}return 0}function _(e){if(!e||0===e.length)return null;const t=new r.Z(e).toRgba();return{r:t[0],g:t[1],b:t[2],a:t[3]}}function X(e,t,i,r,o,a,n){const l=t[e];if(l){const e=l[i];if("string"==typeof e||"number"==typeof e||e instanceof Array)return a?a.call(null,e,n):e;if(null!=e&&e instanceof s.mz)return(t,i,s)=>{let l=(0,m.Z)(e,t,{$view:s},r.geometryType,i);return null!==l&&a&&(l=a.call(null,l,n)),null!==l?l:o}}return o}function H(e,t,i,r){for(const e of i)if(e.valueExpressionInfo){const i=t[e.primitiveName]&&t[e.primitiveName][e.propertyName];i instanceof s.mz&&(e.fn=(e,t,o)=>(0,m.Z)(i,e,{$view:o},r.geometryType,t))}return(t,r,o)=>{for(const e of i)e.fn&&(e.value=e.fn(t,r,o));return(0,n.hP)(e+l.E0.buildOverrideKey(i)).toString()}}function A(e,t){if(!t||0===t.length)return e;const i=JSON.parse(JSON.stringify(e));return l.E0.applyOverrides(i,t),i}function Y(e,t){let i=!1,r="";for(const o of e)o.primitiveName===t&&(void 0!==o.value?r+=`-${o.primitiveName}-${o.propertyName}-${JSON.stringify(o.value)}`:o.valueExpressionInfo&&(i=!0));return[i,r]}}}]);